## ClientBalance

### Общее описание
Сервис, управляющий балансом пользователей нашей системы.
Данный сервис по запросу инициализирует новых пользователей.
Управляет их балансом с помощью пополнения или снятия, например, для оплаты новых заказов.
А также отображает баланс в личном кабинете пользователей.

Поддерживается удаление операций, которые потеряли актуальность и больше не нужны.
И также есть возможность для просмотра истории пользователями, либо поддержкой.

#### Детальное описание:

- У сервиса реализованы 7 gRPC ручек:
    1. Создание нового пользователя
        - Входные данные:
            - Идентификатор пользователя (long)
        - Выходные данные:
            - Отсутствуют 
    2. Операция пополнения баланса
        - Входные данные:
            - Идентификатор операции (guid)
            - Идентификатор пользователя
            - Сумма пополнения
            - Время
        - Выходные данные:
            - Отсутствуют 
        - Примечание:
            - Сумма зачисляется только после подтверждения
            - Операции пополнения храняться в своей отдельной таблице
    3. Операция снятия денег с баланса
        - Входные данные:
            - Идентификатор операции (guid)
            - Идентификатор пользователя
            - Сумма снятия
            - Время
        - Выходные данные:
            - Данные о возможности проведения опреации. В случае если баланса недостаточно, то вернуть false 
        - Примечание:
            - Сумма вычитатается из баланса сразу же, если это возможно. Иначе сохраняется в БД информация об отмене. Например, в статусе reject
            - Операции снятия храниться в своей отдельной таблице
    4. Изменения статуса операции
        - Входные данные:
            - Идентификатор операции (guid)
            - Тип операции (TopUp, Withdraw)
            - Идентификатор пользователя
            - Статус операции (cancelled, completed)
            - Время
        - Выходные данные:
            - Отсутствуют 
        - Примечание:
            - В случае с пополением сумма либо добавляется (completed), либо нет (cancelled).
            - В случае со снятием либо возвращаются средста на счет (cancelled), либо остаются снятыми (completed).
    5. Получение текущего баланса пользователя
        - Входные данные:
            - Id пользователя
        - Выходные данные:
            - Текущий баланс
    6. Ручка по удалению операций устаревших
        - Входные данные:
            - Массив (Идентификатор операции + тип операции)
        - Выходные данные:
            - Отсутствуют 
    7. Ручка с историей по операциям
        - Входные данные:
            - Идентификатор пользователя
        - Выходные данные:
            - Идентификатор операции 
            - Тип операции
            - Сумма
            - Статус
            - Время
         - Примечание:
            - Таблица создана с автоувеличивающимся ключом, чтобы по нему доставать оперции в правильном порядке. Операции возвращаются по порядку их первоначальному происхождению, а также только их финальный статус, если были переходы. При этом в таблице храниться вся история с операциями. Что по сути является логом всех операций.
             
- Статусы у опреций следующе:
    - pending
    - cancelled
    - completed
    - reject
    
- Обеспечивается в сервисе сохранение пользователей и операций.
- Создан слой миграций, с использованием `FluentMigrator`. Миграция - на языке SQL, создает таблицы и индексы. Управляются миграции при помощи выбора профиля запуска в launchSettings.json.

#### Настройки сервиса

Настройки можно указать через переменные окружения.

#### Строка подключения к серверу БД №1
Название переменной окружения: `DEMO_CLIENT_BALANCE_SERVICE_DB_CONNECTION_STRING`
Допустимые значения (строка)
