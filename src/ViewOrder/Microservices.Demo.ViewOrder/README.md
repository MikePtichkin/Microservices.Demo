### Описание
ViewOrder сервис-витрина для заказов. Такие сервисы обычно используются в качестве read-моделей, которые позволяют
снизить нагрузку на операционную БД, сделать данные более доступными, обогатить информацией с других сервисов и обеспечить более высокие
сроки хранения информации. Все это накладывает на них определенные ограничения, например:
- более сложная инфраструктура
- асинхронное взаимодействие с мастер-системами.

Данная витрина выполняет следующие задачи:
- собирает информацию по заказам на основе событий
- сохраняет ее в шардированной БД

### Внутреннее устройство доступа к данным:
1. Существует механизм миграций схем и данных в шардированной инфраструктуре
2. Реализован DAL (data access layer) слой, который через репозитории позволяет сохранять и получать данные из шардированной БД
3. Настройки задаются через переменные окружения
4. Сервис имеет 2 сервера БД (строки подключения из переменных окружения)
   - **view-order-service-db-shard-1**
   - **view-order-service-db-shard-2**
5. Общее кол-во бакетов 10, в каждом шарде по 5 бакетов.
6. В каждом бакете представлена таблица **orders** с полями:
   - OrderId - bigint - уникальный идентификатор заказа
   - RegionId - bigint - идентификатор региона заказа
   - Status - int - актуальный статус заказа
   - CustomerId - bigint - уникальный идентификатор заказчика
   - Comment - text - комментарий по заказу
   - CreatedAt - tz - дата создания заказа UTC
7. Таблица **orders** накатываться по бакетам миграцией через FluentMigrator
8. Ключ шардирования - идентификатор заказа (`order_id`)
9. Для работы с БД используется Dapper
10. Методы репозитория

   10.1. Метод вставки данных заказа в нужный бакет (в соответствии с набором полей п.6)

   10.2. Метод обновления данных заказа в нужном бакете по идентификатору заказа (в соответствии с набором полей п.6)

   10.3. Метод получения списка заказов (возвращает набор полей п.6) по:

      10.3.1. набору идентификаторов заказов

      10.3.2. набору идентификаторов регионов

      10.3.3. набору идентификаторов заказчиков

      10.3.4. диапазону строк выборки (limit/offset)

11. Для вставки и обновления данных используются пользовательские типы данных, которые определены в public-схеме каждого шарда.


#### Настройки сервиса

Настройки указываются через переменные окружения.

##### Строка подключения к серверу БД №1
Название переменной окружения: `DEMO_VIEW_ORDER_SERVICE_DB_SHARD1_CONNECTION_STRINGS`

##### Строка подключения к серверу БД №2
Название переменной окружения: `DEMO_VIEW_ORDER_SERVICE_DB_SHARD2_CONNECTION_STRINGS`

##### Количество бакетов на сервере
Название переменной окружения: `DEMO_VIEW_ORDER_SERVICE_DB_BUCKETS_PER_SHARD`
Допустимые значения 1-100 (по умолчанию - 5)

##### Адреса брокеров кафки
Название переменной окружения: `DEMO_KAFKA_BROKERS`
Список адресов хостов брокеров кафки, разделенных через запятую

У сервиса есть слой бизнес-логики, который:
- получает события по заказу из топика **order_output_events**
- сохраняет текущее состояние заказа в шардированной БД

В сервисе реализован консьюмер топика **order_output_events** и gRPC клиент для сервиса **order-service** чтобы получать информацию о заказах из **V1QueryOrders**.
Реализовано сохранение заказов в шардированной БД с использованием методов репозитория.


